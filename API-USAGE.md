# API Usage Guide\n\n## Quick Start\n\n### Start Development Server\n```bash\nnpm run dev\n```\n\n### Build for Production\n```bash\nnpm run build\nnpm start\n```\n\n## API Endpoints\n\n### Health Check\n```bash\nGET /health\nGET /up\n```\nResponse:\n```json\n{\n  \"status\": \"OK\",\n  \"timestamp\": \"2025-11-21T02:46:00.384Z\",\n  \"uptime\": 12345\n}\n```\n\n### Get All Products\n```bash\nGET /api/products?page=1&limit=100\n```\n\nQuery Parameters:\n- `page` (optional): Page number, default 1\n- `limit` (optional): Items per page, default 100\n\nResponse:\n```json\n{\n  \"success\": true,\n  \"data\": [\n    {\n      \"category\": \"XL DATA COMBO\",\n      \"code\": \"XDC1\",\n      \"description\": \"DATA XL COMBO 1GB + 2GB YTB 30Hr 24Jam+10Mnt All\",\n      \"price\": 51350,\n      \"status\": {\n        \"text\": \"Open\",\n        \"available\": true,\n        \"status\": \"open\"\n      }\n    }\n  ],\n  \"pagination\": {\n    \"currentPage\": 1,\n    \"totalPages\": 25,\n    \"totalItems\": 2418,\n    \"itemsPerPage\": 100,\n    \"hasNextPage\": true,\n    \"hasPrevPage\": false\n  },\n  \"metadata\": {\n    \"lastUpdate\": \"2025-11-21T02:46:00.384Z\",\n    \"lastFetch\": \"2025-11-21T02:46:00.384Z\",\n    \"totalProducts\": 2418\n  }\n}\n```\n\n### Search Products\n```bash\nGET /api/products/search?q=xl&category=DATA&page=1&limit=50\n```\n\nQuery Parameters:\n- `q` (optional): Search query (code or description)\n- `category` (optional): Filter by category\n- `page` (optional): Page number, default 1\n- `limit` (optional): Items per page, default 50\n\n### Get Products by Category\n```bash\nGET /api/products/category/XL%20DATA%20COMBO\n```\n\n### Get Available Products Only\n```bash\nGET /api/products/available\n```\n\n### Get All Categories\n```bash\nGET /api/categories\n```\nResponse:\n```json\n{\n  \"success\": true,\n  \"data\": [\n    \"XL DATA COMBO\",\n    \"TELKOMSEL DATA\",\n    \"INDOSAT DATA\"\n  ],\n  \"metadata\": {\n    \"totalCategories\": 45,\n    \"lastUpdate\": \"2025-11-21T02:46:00.384Z\"\n  }\n}\n```\n\n### Get System Status\n```bash\nGET /api/status\n```\nResponse:\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"scheduler\": {\n      \"isRunning\": false,\n      \"error\": \"Scheduler not available in serverless\"\n    },\n    \"cache\": {\n      \"hasData\": true,\n      \"lastUpdate\": \"2025-11-21T02:46:00.384Z\",\n      \"lastFetch\": \"2025-11-21T02:46:00.384Z\",\n      \"dataCount\": 2418\n    },\n    \"timestamp\": \"2025-11-21T02:46:00.384Z\"\n  }\n}\n```\n\n### Manual Refresh Data\n```bash\nPOST /api/refresh\n```\nResponse:\n```json\n{\n  \"success\": true,\n  \"message\": \"Data refreshed successfully\",\n  \"metadata\": {\n    \"updated\": true,\n    \"lastUpdate\": \"2025-11-21T02:46:00.384Z\",\n    \"lastFetch\": \"2025-11-21T02:46:00.384Z\",\n    \"totalProducts\": 2418,\n    \"changes\": [\n      {\n        \"code\": \"XDC1\",\n        \"category\": \"XL DATA COMBO\",\n        \"price\": 51350,\n        \"status\": {\n          \"text\": \"Open\",\n          \"available\": true\n        },\n        \"priceChange\": {\n          \"old\": 50000,\n          \"new\": 51350,\n          \"difference\": 1350,\n          \"type\": \"increase\"\n        }\n      }\n    ]\n  }\n}\n```\n\n### Test Telegram Notification\n```bash\nPOST /api/test-telegram\n```\nResponse:\n```json\n{\n  \"success\": true,\n  \"message\": \"Telegram connection successful\",\n  \"metadata\": {\n    \"timestamp\": \"2025-11-21T02:46:00.384Z\"\n  }\n}\n```\n\n## Error Responses\n\nAll error responses follow this format:\n```json\n{\n  \"error\": \"Error Type\",\n  \"message\": \"Detailed error message\"\n}\n```\n\nCommon HTTP Status Codes:\n- `200` - Success\n- `404` - Route not found or no data available\n- `500` - Internal server error\n\n## Data Models\n\n### Product\n```typescript\ninterface Product {\n  category: string\n  code: string\n  description: string\n  price: number\n  status: {\n    text: string\n    available: boolean\n    status: string\n  }\n}\n```\n\n### Change Detection\n```typescript\ninterface Change {\n  code: string\n  category: string\n  price: number\n  status: {\n    text: string\n    available: boolean\n  }\n  priceChange?: {\n    old: number\n    new: number\n    difference: number\n    type: 'increase' | 'decrease'\n  }\n  statusChange?: {\n    old: Status\n    new: Status\n  }\n}\n```\n\n## Rate Limiting\n\n- No explicit rate limiting is implemented\n- Scraper fetches data every minute from source\n- Use caching on client side to reduce API calls\n\n## CORS\n\n- All origins allowed (`*`)\n- Methods: `GET, POST, PUT, DELETE, OPTIONS`\n- Headers: `Content-Type, Authorization`\n\n## Examples\n\n### JavaScript/React\n```javascript\n// Fetch all products\nconst fetchProducts = async () => {\n  const response = await fetch('/api/products?page=1&limit=50')\n  const data = await response.json()\n  return data\n}\n\n// Search products\nconst searchProducts = async (query, category) => {\n  const params = new URLSearchParams()\n  if (query) params.append('q', query)\n  if (category) params.append('category', category)\n  \n  const response = await fetch(`/api/products/search?${params}`)\n  const data = await response.json()\n  return data\n}\n\n// Manual refresh\nconst refreshData = async () => {\n  const response = await fetch('/api/refresh', {\n    method: 'POST'\n  })\n  const data = await response.json()\n  return data\n}\n```\n\n### cURL Examples\n```bash\n# Get products with pagination\ncurl \"http://localhost:3000/api/products?page=1&limit=20\"\n\n# Search for XL products\ncurl \"http://localhost:3000/api/products/search?q=xl\"\n\n# Get specific category\ncurl \"http://localhost:3000/api/products/category/XL%20DATA%20COMBO\"\n\n# Manual refresh\ncurl -X POST \"http://localhost:3000/api/refresh\"\n\n# Health check\ncurl \"http://localhost:3000/health\"\n```\n\n### Python\n```python\nimport requests\n\n# Get all products\nresponse = requests.get('http://localhost:3000/api/products')\ndata = response.json()\n\n# Search products\nresponse = requests.get('http://localhost:3000/api/products/search', {\n    'params': {'q': 'xl', 'category': 'DATA'}\n})\nsearch_results = response.json()\n\n# Manual refresh\nresponse = requests.post('http://localhost:3000/api/refresh')\nrefresh_result = response.json()\n```\n\n## Best Practices\n\n1. **Pagination**: Always use pagination for large datasets\n2. **Caching**: Cache responses on client side to reduce load\n3. **Error Handling**: Always check `success` field in responses\n4. **Search**: Use specific categories to narrow down results\n5. **Monitoring**: Regularly check `/api/status` for system health\n\n## Frontend Integration\n\nThis API is designed to work seamlessly with the Next.js frontend. The frontend provides:\n- Interactive product search and filtering\n- Real-time data visualization\n- Telegram notification testing\n- Change detection monitoring\n- Live data scraping controls\n\nAccess the frontend at `/` (root path) when running the application.\n"